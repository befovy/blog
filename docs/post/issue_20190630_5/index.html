<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>ç”¨ CMake ä¸º ijkplayer å¢åŠ  android native debug æ”¯æŒ - Befovy çš„åšå®¢ | Befovy blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Befovy" /><meta name="description" content="ç»™ ijkplayer å¢åŠ äº† cmake æ„å»ºæ–¹å¼ï¼Œæ”¯æŒåœ¨ android studio ä¸­è¿›è¡Œ c ä»£ç æ–­ç‚¹è°ƒè¯•ã€‚ ç›´æ¥ä¸Šæ‰‹è¯·å‰å¾€ https://github.com/befovy/ijkplayer#build-android-via-cmake å¦‚æœæƒ³äº†è§£ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹è¯·ç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚ ijkplayer ç®€ä»‹ ijkplayer æ˜¯ç”± B ç«™å¼€æºçš„ä¸€æ¬¾ç§»åŠ¨ç«¯" />






<meta name="generator" content="Hugo 0.53 with even 4.0.0" />


<link rel="canonical" href="https://befovy.com/post/issue_20190630_5/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="ç”¨ CMake ä¸º ijkplayer å¢åŠ  android native debug æ”¯æŒ" />
<meta property="og:description" content="ç»™ ijkplayer å¢åŠ äº† cmake æ„å»ºæ–¹å¼ï¼Œæ”¯æŒåœ¨ android studio ä¸­è¿›è¡Œ c ä»£ç æ–­ç‚¹è°ƒè¯•ã€‚ ç›´æ¥ä¸Šæ‰‹è¯·å‰å¾€ https://github.com/befovy/ijkplayer#build-android-via-cmake å¦‚æœæƒ³äº†è§£ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹è¯·ç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚ ijkplayer ç®€ä»‹ ijkplayer æ˜¯ç”± B ç«™å¼€æºçš„ä¸€æ¬¾ç§»åŠ¨ç«¯" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://befovy.com/post/issue_20190630_5/" /><meta property="article:published_time" content="2019-06-30T15:26:52&#43;00:00"/>
<meta property="article:modified_time" content="2019-08-12T02:13:44&#43;00:00"/>

<meta itemprop="name" content="ç”¨ CMake ä¸º ijkplayer å¢åŠ  android native debug æ”¯æŒ">
<meta itemprop="description" content="ç»™ ijkplayer å¢åŠ äº† cmake æ„å»ºæ–¹å¼ï¼Œæ”¯æŒåœ¨ android studio ä¸­è¿›è¡Œ c ä»£ç æ–­ç‚¹è°ƒè¯•ã€‚ ç›´æ¥ä¸Šæ‰‹è¯·å‰å¾€ https://github.com/befovy/ijkplayer#build-android-via-cmake å¦‚æœæƒ³äº†è§£ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹è¯·ç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚ ijkplayer ç®€ä»‹ ijkplayer æ˜¯ç”± B ç«™å¼€æºçš„ä¸€æ¬¾ç§»åŠ¨ç«¯">


<meta itemprop="datePublished" content="2019-06-30T15:26:52&#43;00:00" />
<meta itemprop="dateModified" content="2019-08-12T02:13:44&#43;00:00" />
<meta itemprop="wordCount" content="2232">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ç”¨ CMake ä¸º ijkplayer å¢åŠ  android native debug æ”¯æŒ"/>
<meta name="twitter:description" content="ç»™ ijkplayer å¢åŠ äº† cmake æ„å»ºæ–¹å¼ï¼Œæ”¯æŒåœ¨ android studio ä¸­è¿›è¡Œ c ä»£ç æ–­ç‚¹è°ƒè¯•ã€‚ ç›´æ¥ä¸Šæ‰‹è¯·å‰å¾€ https://github.com/befovy/ijkplayer#build-android-via-cmake å¦‚æœæƒ³äº†è§£ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹è¯·ç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚ ijkplayer ç®€ä»‹ ijkplayer æ˜¯ç”± B ç«™å¼€æºçš„ä¸€æ¬¾ç§»åŠ¨ç«¯"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Befovy</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Befovy</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">ç”¨ CMake ä¸º ijkplayer å¢åŠ  android native debug æ”¯æŒ</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-06-30 </span>
        
          <span class="more-meta"> çº¦ 2232 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 5 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#ijkplayer-ç®€ä»‹">ijkplayer ç®€ä»‹</a></li>
<li><a href="#android-å·¥ç¨‹ç»“æ„è°ƒæ•´">android å·¥ç¨‹ç»“æ„è°ƒæ•´</a></li>
<li><a href="#cmakelists-txt">CMakeLists.txt</a></li>
<li><a href="#ç»“æŸè¯­">ç»“æŸè¯­</a></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<p>ç»™ ijkplayer å¢åŠ äº† cmake æ„å»ºæ–¹å¼ï¼Œæ”¯æŒåœ¨ android studio ä¸­è¿›è¡Œ c ä»£ç æ–­ç‚¹è°ƒè¯•ã€‚<br />
ç›´æ¥ä¸Šæ‰‹è¯·å‰å¾€ <a href="https://github.com/befovy/ijkplayer#build-android-via-cmake">https://github.com/befovy/ijkplayer#build-android-via-cmake</a></p>

<p>å¦‚æœæƒ³äº†è§£ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹è¯·ç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚</p>

<!--mirror-->

<h1 id="ijkplayer-ç®€ä»‹">ijkplayer ç®€ä»‹</h1>

<p><a href="https://github.com/Bilibili/ijkplayer">ijkplayer</a>  æ˜¯ç”± B ç«™å¼€æºçš„ä¸€æ¬¾ç§»åŠ¨ç«¯æ’­æ”¾å™¨ã€‚åŸºäº ffmpeg ä¸­ ffplay å¼€å‘ï¼Œå¹¶æ·»åŠ  android MediaCodecã€iOS VideotTolbox è§†é¢‘ç¡¬è§£ç æ”¯æŒä»¥åŠ openglesã€NativeWindow(android) æ¸²æŸ“ï¼Œåœ¨å½“å‰çš„ç§»åŠ¨ç›´æ’­çƒ­æ½®ä¸­ï¼Œè¢«å¤§é‡ä½¿ç”¨ã€‚
ä½†ä½¿ç”¨ ijkplayer è¿›è¡Œ android æ’­æ”¾å™¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•èµ·æ¥ç¨å¾®æœ‰äº›éº»çƒ¦ï¼Œå®˜æ–¹æä¾›äº†ndk è°ƒè¯•çš„å‡ ä¸ªpatch æ–‡ä»¶ï¼Œå¹¶ä¸”æœ‰ä¸€æ®µæè¿°ï¼Œæ˜¯åŸºäº ndk-build android.mk å·¥å…·é“¾æ„å»ºçš„ã€‚è¯´å®è¯ç”±äºæ²¡æœ‰åšæˆå¼€ç®±å³ç”¨ï¼Œæˆ‘ä¹Ÿæ²¡è®¤çœŸçœ‹è¿‡è¿™éƒ¨åˆ†å†…å®¹ã€‚ ç”±äºæˆ‘å¯¹ cmake çš„äº†è§£æ›´å¤šä¸€äº›ï¼ŒåŠ ä¹‹ google å®˜æ–¹ä¹Ÿé€æ¸å°† ndk çš„å·¥å…·é“¾ç”± ndk-build è½¬å‘ cmakeï¼Œå¹¶åœ¨ android studio ä¸­å¯¹ cmake æä¾›äº†æ›´å¥½çš„æ”¯æŒã€‚åŒæ—¶ cmake ä¹Ÿæ˜¯è·¨å¹³å°çš„æ„å»ºå·¥å…·ï¼Œæ–¹ä¾¿åç»­å°† ijkplayer æ‰©å±•è‡³å…¶å®ƒå¹³å°ï¼Œæ‰€ä»¥æˆ‘ç”¨ cmake é‡æ–°å®ç°äº† ijkplayer çš„æ„å»ºè¿‡ç¨‹ã€‚</p>

<p>åªè¦ä¸æ˜¯ä¿®æ”¹ ffmpeg çš„æºä»£ç ï¼Œå…¶å®ƒå†…å®¹åŒ…æ‹¬ ijkplayer çš„ c ä»£ç ä¿®æ”¹ï¼Œ java å±‚ä¿®æ”¹ï¼Œéƒ½å¯ä»¥åœ¨ android studio ä¸­ä¸€é”®è¿è¡Œã€è°ƒè¯•ã€‚</p>

<p>å…³äº ijkplayer å†…éƒ¨æ ¸å¿ƒä»£ç çš„åˆ†æï¼Œå¤šä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å®¹ï¼Œè§£ç éƒ¨åˆ†ï¼ŒéŸ³è§†é¢‘åŒæ­¥æ§åˆ¶ç­‰éƒ¨åˆ†çš„æ›´æ·±å…¥çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒé‡‘å±±äº‘è§†é¢‘çš„åˆ†ææ–‡ç«   <a href="https://www.jianshu.com/p/daf0a61cc1e0">https://www.jianshu.com/p/daf0a61cc1e0</a> ï¼Œ æˆ‘æœ€å¼€å§‹ä¹Ÿæ˜¯ä»è¿™ä¸€ç¯‡æ–‡ç« å…¥æ‰‹é€æ¸è¯»æ‡‚ ijkplayer æºä»£ç çš„ã€‚</p>

<p>é¢˜å¤–è¯ï¼šijkplayer åœ¨ github ä¸Šçš„æäº¤è®°å½•è‡ª k0.8.8 ç‰ˆæœ¬ä¹‹åå°±å†ä¹Ÿæ²¡æœ‰äº†ï¼Œå¥½å¤šäººè¯„è®ºè¯´é¡¹ç›®å·²ç»æ”¾å¼ƒç»´æŠ¤äº†ï¼Œä½†æ˜¯ç»†å¿ƒå¯»æ‰¾ä¼šå‘ç°åœ¨å¦ä¸€ä¸ªé¡¹ç›® <a href="https://github.com/bilibili/FFmpeg/releases">Bilibili/ffmpeg</a> ä¸­ï¼Œè¿˜ä¸æ–­æœ‰æäº¤è®°å½•ã€‚è¯´æ˜é¡¹ç›®è¿˜æ˜¯åœ¨ä¸æ–­å¼€å‘ï¼Œåªæ˜¯é‡å¿ƒæ”¾åœ¨å®ç°æ–°çš„ ffmpeg protocol ä¸Šï¼Œæ²¡æœ‰åŠæ—¶ç»´æŠ¤ ijkplayer é¡¹ç›®ä¸Šçš„ issuesã€‚</p>

<p>ä¸‹é¢å…·ä½“è¯´è¯´ä¸€äº›å…·ä½“çš„ä¿®æ”¹å†…å®¹ã€‚</p>

<!--mirror-->

<h1 id="android-å·¥ç¨‹ç»“æ„è°ƒæ•´">android å·¥ç¨‹ç»“æ„è°ƒæ•´</h1>

<p>ijkplayer çš„é¡¹ç›®æœ¬èº«å…·æœ‰å¤šä¸ª android moduleã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></pre></td>
<td class="lntd">
<pre class="chroma">ijkplayer-arm64
ijkplayer-armv5
ijkplayer-armv7a
ijkplayer-x86
ijkplayer-x86_64   # ä¸Šé¢å‡ ä¸ªéƒ½æ˜¯ä¸€ä¸ªmodule å£³ï¼Œshell å‘½ä»¤ç¼–è¯‘å¥½ so åº“æ”¾åœ¨æŒ‡å®šç›®å½•ä¸­
ijkplayer-example  # ç¤ºä¾‹APPé¡¹ç›®
ijkplayer-exo      # å¯¹ google exoplayer çš„ä¸€å±‚å°è£…é€‚ï¼Œé…åˆijkplayer å®šä¹‰çš„ mediaplyer æ¥å£
ijkplayer-java     # ijkplayer java å±‚ä»£ç ï¼Œå¯¹æ¥ native å±‚ä»£ç ï¼Œä»¥åŠç¡¬è§£ç å™¨çš„é€‰æ‹©</pre></td></tr></table>
</div>
</div>
<p>é¡¹ç›®ä¸­ä¸ºä¸åŒçš„ cpu æ¶æ„éƒ½å•ç‹¬è®¾ç½®äº† moduleï¼Œè¿™å‡ ä¸ª module æœ€å¤§çš„åŒºåˆ«å°±æ˜¯åœ¨ Application.mk ä¸­ <code>APP_ABI</code> å’Œ <code>APP_PLATFORM</code> çš„å€¼ä¸åŒï¼Œå…¶ä¸­  <code>APP_PLATFORM</code> å–å€¼å’Œ build.gradle ä¸­å®šä¹‰çš„ minSdkVersion ç›¸åŒã€‚
ijkplayer æœ€ä½ç«Ÿç„¶æ”¯æŒ sdk version 9ï¼Œç¡®å®æ„Ÿè°¢ B ç«™é¡¹ç›®ç»„åˆæœŸåœ¨è¿™æ–¹é¢çš„è¾›è‹¦ä»˜å‡ºã€‚</p>

<p>è¿™ç§ module ç¡®å®æ–¹ä¾¿é‡‡ç”¨ ndk-build å·¥å…·çš„é¡¹ç›®ç®¡ç†ï¼Œä½†æ˜¯æˆ‘åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æ˜¯è§‰å¾—æœ‰äº›ä¸å¤ªæ–¹ä¾¿ä¹‹å¤„ï¼š
1. åœ¨ android studio ä¸­æœç´¢ c ä»£ç ï¼Œæœç´¢ç»“æœä¸­é‡å¤å‡ºç°å¤šæ¬¡
2. android studio ä¸­çš„ c ä»£ç æ²¡æœ‰è¯­æ³•é«˜äº®ã€‚</p>

<p>å¯¹äºé—®é¢˜1ï¼Œæˆ‘æ‰¾åˆ°çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-gradle" data-lang="gradle"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-gradle" data-lang="gradle"><span class="c1">//NOTE:: run `./gradlew ideaModule` to apply exclude dirs
</span><span class="c1"></span><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;idea&#39;</span>

<span class="n">idea</span><span class="o">.</span><span class="na">module</span> <span class="o">{</span>
    <span class="n">excludeDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;ijkplayer-armv7a/src/&#39;</span><span class="o">)</span>
    <span class="n">excludeDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;ijkplayer-arm64/src/&#39;</span><span class="o">)</span>
    <span class="n">excludeDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;ijkplayer-armv5/src/&#39;</span><span class="o">)</span>
    <span class="n">excludeDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;ijkplayer-x86/src/&#39;</span><span class="o">)</span>
    <span class="n">excludeDirs</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s1">&#39;ijkplayer-x86_64/src/&#39;</span><span class="o">)</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>åœ¨å·¥ç¨‹æ ¹ build.gradle ä¸­å¢åŠ è¿™æ ·çš„é…ç½®ï¼Œå¹¶æ‰§è¡Œ <code>./gradlew ideaModule</code>ï¼Œ å°±ä¼šåœ¨æœç´¢ç»“æœä¸­æ’é™¤æ¥è‡ªè¿™å‡ ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹ã€‚</p>

<p>å¯¹äºé—®é¢˜2ï¼Œæˆ‘å½“ç„¶æ˜¯ç”¨ cmake è§£å†³äº†ï¼Œæ–°å»ºä¸€ä¸ª module, å–å fijkplayer-fullã€‚æ¢ä¸ªåå­—æ–¹ä¾¿å’ŒåŸé¡¹ç›®è¿›è¡ŒåŒºåˆ†ï¼ŒåŒæ—¶ f ä¹Ÿè¡¨ç¤º<code>full</code>, æˆ‘åœ¨è¿™ä¸ª module ä¸­å›Šæ‹¬äº†åŸæ¥ 6 ä¸ª module æä¾›çš„å†…å®¹ã€‚ f è¿˜æœ‰åˆ«çš„å«ä¹‰ï¼Œæœ‰æœºä¼šåœ¨å…¶å®ƒåœ°æ–¹ä¼šæåˆ°ã€‚
åœ¨ fijkplayer-full çš„ build.gradel ä¸­å¢åŠ  cmake çš„é…ç½®ä»¥åŠå¼•å…¥ ijkplayer-java module çš„ java æºä»£ç ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-gradle" data-lang="gradle"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-gradle" data-lang="gradle"><span class="n">android</span> <span class="o">{</span>
    <span class="o">.......</span>
    <span class="o">.......</span>
    <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span> <span class="o">{</span>
        <span class="n">java</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;$rootProject.rootDir/ijkplayer-java/src/main/java/&#34;</span><span class="o">]</span>
        <span class="n">jni</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">=</span> <span class="o">[]</span> <span class="c1">// This prevents the auto generation of Android.mk
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="n">externalNativeBuild</span> <span class="o">{</span>
        <span class="n">cmake</span> <span class="o">{</span>
            <span class="n">path</span> <span class="s1">&#39;src/main/CMakeLists.txt&#39;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>ä¿®æ”¹åï¼Œfijkplayer-full å°±æˆäº† &ldquo;å…­ç¥åˆä½“&rdquo; äº†ã€‚</p>

<p>å¯¹äºä¸åŒcpu æ¶æ„åŒºåˆ†ä¸åŒçš„ minSdkVersion å¯ä»¥é€šè¿‡ productFlavors å®ç°ï¼Œè¿™ä¸€å—æˆ‘è¿˜æ²¡æœ‰å…·ä½“è€ƒè™‘å……åˆ†ï¼Œç›®å‰æ˜¯ç»Ÿä¸€è®¾ç½®äº†å¤§å®¶ç”¨å¾—æœ€å¤šçš„ minSdkVersion 16ã€‚</p>

<p>æ­¤éƒ¨åˆ†ä¿®æ”¹çš„å®Œæ•´å†…å®¹<a href="https://github.com/befovy/ijkplayer/blob/master/android/ijkplayer/fijkplayer-full/build.gradle">ç‚¹æˆ‘æŸ¥çœ‹, github.com/befovy/ijkplayer</a></p>

<!--mirror-->

<h1 id="cmakelists-txt">CMakeLists.txt</h1>

<p>ç¼–å†™ CMakeLists.txt å®Œå…¨æ˜¯ä¸ªç¿»è¯‘å·¥ä½œï¼Œå°† Android.mk ä¸­çš„è§„åˆ™ç¿»è¯‘è¿‡æ¥å°±è¡Œã€‚å®Œæˆåé€šè¿‡ CMake æ–¹å¼æœ€ç»ˆç”Ÿæˆçš„ aar å’ŒåŸå§‹æ–¹å¼ç”Ÿæˆçš„aar æ–‡ä»¶å¤§å°å‡ ä¹æ²¡ä»€ä¹ˆå·®åˆ«ï¼Œè§ä¸‹å›¾ã€‚
fijkplayer-full åªç¼–è¯‘äº† armv7a æ¶æ„ï¼Œå’Œ ijkplayer-armv7a æ¨¡å—ç¼–è¯‘ç»“æœçš„å¯¹æ¯”ã€‚
fijkplayer-full ä¸­ classes.jar è¾ƒå¤§æ˜¯å› ä¸ºåŒ…å«äº† ijkplayer-java module ä¸­çš„å†…å®¹ã€‚
è¿˜å¯ä»¥è°ƒæ•´CMake å‚æ•°è¿›ä¸€æ­¥å‡å°ç”Ÿæˆåº“çš„å¤§å°ã€‚
<img width="855" alt="å›¾ç‰‡" src="https://user-images.githubusercontent.com/51129600/60667705-bfb66800-9e9c-11e9-9181-bed0f2fd86a1.png"></p>

<p>è½¬åˆ° CMake å·¥å…·é“¾çš„è¿‡ç¨‹è¿˜é‡åˆ°ä¸‹é¢å‡ ä¸ªé—®é¢˜ã€‚</p>

<p><strong>libffmpeg.so æ‰¾ä¸åˆ°</strong></p>

<p>libffmpeg.so æ˜¯äº‹å…ˆé€šè¿‡ shell å‘½ä»¤ç¼–è¯‘æˆçš„ï¼Œåœ¨ ffmpeg build æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä¸”å‡ ä¹ä¸ä¼šæ”¹å˜ï¼Œé™¤éæ˜¯è¦ä¿®æ”¹ ffmpegã€‚
åœ¨ CMake ä¸­é€šè¿‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-cmake" data-lang="cmake"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmake" data-lang="cmake"><span class="nb">add_library</span><span class="p">(</span><span class="s">ijkffmpeg</span> <span class="s">SHARED</span> <span class="s">IMPORTED</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">set_target_properties</span><span class="p">(</span> <span class="c"># Specifies the target library.
</span><span class="c"></span>    <span class="s">ijkffmpeg</span>
    <span class="s">PROPERTIES</span>
    <span class="s">IMPORTED_LOCATION</span> <span class="o">${</span><span class="nv">FFMPAG_SHARED_DIR</span><span class="o">}</span><span class="s">/libijkffmpeg.so</span>
<span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<p>å¼•å…¥é¢„ç¼–è¯‘å¥½çš„ ijkffmpegï¼Œåœ¨ç¼–è¯‘ ijkplayer çš„è¿‡ç¨‹å¯ä»¥é¡ºåˆ©å®Œæˆé“¾æ¥ã€‚ä½†æ˜¯æ‰“åŒ…è¿è¡Œæ‰¾ä¸åˆ° libijkffmpeg.soã€‚åˆ†ææœ€ç»ˆçš„ apk ä»¥åŠ fijkplayer-full.aar ï¼Œå‘ç°å…¶ä¸­éƒ½æ²¡æœ‰ libijkffmpeg.so æ–‡ä»¶ï¼Œæ‰€ä»¥æ˜¯æ‰“åŒ… aar çš„æ—¶å€™æ²¡æœ‰å°†è¿™ä¸ªæ–‡ä»¶æ‰“åŒ…è¿›å»ã€‚æŸ¥çœ‹å·¥ç¨‹ç›®å½•ç»“æ„ï¼Œå‘ç°ç¼–è¯‘å¥½çš„ libijkplayer.so å’Œ libijksdl.so éƒ½åœ¨æ–‡ä»¶å¤¹ <code>/build/intermediates/cmake/debug/obj/armeabi-v7a</code> ä¸­ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¿®æ”¹ CMakeLists.txt åœ¨æ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™å°† libijkffmpeg.so å¤åˆ¶è¿‡å»ã€‚æœ€åçš„è§£å†³æ–¹æ¡ˆæ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-cmake" data-lang="cmake"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmake" data-lang="cmake"><span class="nb">add_library</span><span class="p">(</span><span class="s">ijkffmpeg</span> <span class="s">SHARED</span> <span class="s">IMPORTED</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">set_target_properties</span><span class="p">(</span> <span class="c"># Specifies the target library.
</span><span class="c"></span>    <span class="s">ijkffmpeg</span>
    <span class="s">PROPERTIES</span>
    <span class="s">IMPORTED_LOCATION</span> <span class="o">${</span><span class="nv">FFMPAG_SHARED_DIR</span><span class="o">}</span><span class="s">/libijkffmpeg.so</span>
    <span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">cpffmpeg</span>
    <span class="s">COMMAND</span> <span class="s">mkdir</span> <span class="s">-p</span> <span class="o">${</span><span class="nv">CMAKE_LIBRARY_OUTPUT_DIRECTORY</span><span class="o">}</span>
    <span class="s">COMMAND</span> <span class="s">cp</span> <span class="o">${</span><span class="nv">FFMPAG_SHARED_DIR</span><span class="o">}</span><span class="s">/libijkffmpeg.so</span> <span class="o">${</span><span class="nv">CMAKE_LIBRARY_OUTPUT_DIRECTORY</span><span class="o">}</span>
<span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">add_dependencies</span><span class="p">(</span><span class="s">ijkffmpeg</span> <span class="s">cpffmpeg</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<p>æ²¡æœ‰æ‰¾åˆ°ä¸€æ¡å‘½ä»¤èƒ½å¤Ÿè§£å†³çš„ï¼Œæ‰€ä»¥éº»çƒ¦äº†ä¸€ç‚¹å¤šå†™äº†ç‚¹ï¼Œç”¨ä¸¤ä¸ªcmake å‘½ä»¤è§£å†³ã€‚</p>

<p><strong>cpufeatures ç¼–è¯‘å‡ºé”™</strong></p>

<p>åŸé¡¹ç›®ä¸­ç”¨åˆ°äº† ndk ä¸­çš„ cpufeaturesï¼Œæˆ‘åœ¨ CMake æ–‡ä»¶ä¸­ä¹Ÿå¼•å…¥å¹¶ç¼–è¯‘äº† cpufeaturesï¼Œä½†åœ¨ç¼–è¯‘ x86 ä»¥åŠ x86_64 æ¶æ„çš„æ—¶å€™å´å‡ºç°äº†ç¼–è¯‘é”™è¯¯ï¼Œå…·ä½“æ˜¯ä¸€å¤„æœªè¯†åˆ«çš„æ±‡ç¼–æŒ‡ä»¤ã€‚
æœ€åå‘ç°æ˜¯ ndk r15c ç‰ˆæœ¬ä¸­ æ–‡ä»¶  $ANDROID_NDK/sources/android/cpufeatures/cpu-features.c ä¸­å°‘äº†å‡ ä¸ªæ¢è¡Œç¬¦ï¼Œè¡¥ä¸Šä¹‹åï¼ˆä¸‹é¢å†…å®¹ï¼‰ç¼–è¯‘å°±æ²¡é—®é¢˜äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="nf">x86_cpuid</span><span class="p">(</span><span class="kt">int</span> <span class="n">func</span><span class="p">,</span> <span class="kt">int</span> <span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
    <span class="cm">/* We need to preserve ebx since we&#39;re compiling PIC code */</span>
    <span class="cm">/* this means we can&#39;t use &#34;=b&#34; for the second output register */</span>
    <span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span> \
      <span class="s">&#34;push %%ebx&#34;</span>
      <span class="s">&#34;cpuid</span><span class="se">\n</span><span class="s">&#34;</span> \
      <span class="s">&#34;mov %%ebx, %1</span><span class="se">\n</span><span class="s">&#34;</span>
      <span class="s">&#34;pop %%ebx</span><span class="se">\n</span><span class="s">&#34;</span>
      <span class="o">:</span> <span class="s">&#34;=a&#34;</span> <span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="s">&#34;=r&#34;</span> <span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="s">&#34;=c&#34;</span> <span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="s">&#34;=d&#34;</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> \
      <span class="o">:</span> <span class="s">&#34;a&#34;</span> <span class="p">(</span><span class="n">func</span><span class="p">)</span> \
    <span class="p">);</span>
    <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>æ„å¤–çš„æ˜¯æˆ‘æœ€ç»ˆå‘ç° ijkplayer é¡¹ç›®ä¸­æ²¡æœ‰ç”¨åˆ° cpufeatures çš„åœ°æ–¹ï¼Œå¯èƒ½æ˜¯ gpl åè®®çš„ android-ndk-profiler éƒ¨åˆ†ç”¨äº†å§ï¼Œä½†é¡¹ç›®ä¸­é»˜è®¤ä½¿ç”¨äº†ä¸€ä¸ªå‡çš„ android-ndk-profilerï¼Œæ­¤éƒ¨åˆ†æ²¡æœ‰å»æ·±ç©¶ï¼Œæ€§èƒ½åˆ†æä½¿ç”¨ simpleperf å°±è¶³å¤Ÿäº†ã€‚
æœ€åè¿˜æ˜¯å»æ‰ CMake ä¸­ cpufeatures çš„éƒ¨åˆ†ã€‚</p>

<p>æ­¤éƒ¨åˆ† CMakeLists.txt çš„å®Œæ•´å†…å®¹è¯·çœ‹<br />
<a href="https://github.com/befovy/ijkplayer/blob/master/android/ijkplayer/fijkplayer-full/src/main/CMakeLists.txt">https://github.com/befovy/ijkplayer/blob/master/android/ijkplayer/fijkplayer-full/src/main/CMakeLists.txt</a><br />
<a href="https://github.com/befovy/ijkplayer/blob/master/ijkmedia/CMakeLists.txt">https://github.com/befovy/ijkplayer/blob/master/ijkmedia/CMakeLists.txt</a><br />
<a href="https://github.com/befovy/ijkplayer/blob/master/ijkmedia/ijkplayer/CMakeLists.txt">https://github.com/befovy/ijkplayer/blob/master/ijkmedia/ijkplayer/CMakeLists.txt</a><br />
<a href="https://github.com/befovy/ijkplayer/blob/master/ijkmedia/ijksdl/CMakeLists.txt">https://github.com/befovy/ijkplayer/blob/master/ijkmedia/ijksdl/CMakeLists.txt</a></p>

<!--mirror-->

<h1 id="ç»“æŸè¯­">ç»“æŸè¯­</h1>

<p>ğŸ˜„ é™„ä¸€å¼  NDK æ–­ç‚¹è°ƒè¯•çš„å¤§å›¾ ğŸ‘</p>

<p><img width="1130" alt="image" src="https://user-images.githubusercontent.com/51129600/60514475-20fb0180-9d0c-11e9-9a7c-f1dc7cb9414a.png"></p>

<p>åˆšå¼€å§‹å†™åšå®¢ï¼Œå¯èƒ½æœ‰äº›å•°å—¦ï¼Œå¤šå¤šåŒ…æ¶µã€‚æˆ–æ˜¯æ²¡æœ‰è¯´æ˜ç™½çš„åœ°æ–¹ï¼Œè¯·å¤§æ–¹çš„å‰å¾€<a href="https://github.com/befovy/befovy.github.io/issues/3">åŸå§‹åœ°å€</a>è¿›è¡Œè¯„è®ºã€‚</p>

<p>æœ€è¿‘å¯¹ Flutter äº§ç”Ÿäº†å…´è¶£ï¼Œå¹¶æ‰“ç®—ç”¨ ijkplayer å¼€å‘ä¸€ä¸ª Flutter çš„æ’­æ”¾å™¨ Pluginï¼Œ ç¥æˆ‘æ—©æ—¥å®Œæˆã€‚</p>

<blockquote>
<p>æœ¬æ–‡é€šè¿‡ mirror å’Œ hugo ç”Ÿæˆï¼ŒåŸå§‹åœ°å€ <a href="https://github.com/befovy/blogback/issues/5">https://github.com/befovy/blogback/issues/5</a></p>
</blockquote>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Befovy</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2019-08-12
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        
        <a class="next" href="/post/issue_20190630_6/">
            <span class="next-text nav-default">ä½¿ç”¨ mirror å’Œ hugo å®ç° github issue çš„åšå®¢è‡ªåŠ¨åŒæ­¥</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/befovy" class="iconfont icon-github" title="github"></a>
  <a href="https://befovy.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Befovy</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?92addb450ecf9417a02f971789533f13";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
